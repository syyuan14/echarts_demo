<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>地市复工情况</title>
    <script src="./external_js/echarts.min.js"></script>
    <script src="./external_js/jquery-3.4.1.min.js"></script>
    <script src="./external_js/echarts.min.js"></script>
    <style>
        * {
            padding: 0;
            margin: 0;
            text-decoration: none;
        }

        body {
            width: 100%;
            height: 100%;
        }

        .wrapper {
            width: 100vw;
            height: 100vh;
            overflow: auto;
            background: linear-gradient(0deg, rgba(175, 205, 249, 1), rgba(19, 113, 255, 1), rgba(19, 114, 244, 1));
        }

        .wrapper .top {
            width: 100vw;
            height: 22vh;
        }

        .wrapper .top .top-left {
            float: left;
            width: 44vw;
            height: 22vh;
        }

        .wrapper .top .top-right {
            float: left;
            width: 40vw;
            height: 22vh;
        }

        .middle .echart {
            width: 90vw;
            height: 40vh;
            margin: 3vh auto;

            border-radius: 12px;
            overflow: hidden;
        }

        .bottom .bar1 {

            width: 90vw;
            height: 68vh;
            margin: 0 auto;
            margin-bottom: 40px;

            border-radius: 12px;
            overflow: hidden;
        }
    </style>
</head>

<body>
    <div class="wrapper">
        <div class="top">
            <div class="top-left">
                <img src="./img/首页1.png" alt="首页云图" style="width:44vw;height: 23vh;">
            </div>
            <div class="top-right">
                <img src="./img/头部文字.png" alt="首页云图" style="width:50vw;height: 19vh;">
            </div>
        </div>
        <div class="middle">
            <div class="echart">
            </div>
        </div>
        <div class="bottom">
            <div class="bar1"></div>
        </div>
    </div>

</body>
<script>
    // 画折线图一
    var myChart1 = echarts.init(document.querySelector("div.echart"));

    // 指定图表的配置项和数据

    var option1 = {
        backgroundColor: "white",
        title: {
            left: 10,
            top: 10,
            //默认为10
            //2.主副标题之间的间距
            itemGap: 20,
            //padding:2,
            text: '统计企业数',
            textStyle: {
                //文字颜色
                color: '#333333',
                //字体风格,'normal','italic','oblique'
                fontStyle: 'normal',
                //字体粗细 'normal','bold','bolder','lighter',100 | 200 | 300 | 400...
                //fontWeight: 'bold',
                fontWeight: "350",
                //字体系列
                //fontFamily: 'sans-serif',
                //字体大小
                fontSize: 15
            }
        },
        tooltip: {
            trigger: 'axis',
            // formatter: params => {        //可以在此设置每一条数据的hover提示信息，根据params.data中的数据自己判断，然后返回不同的值
            //     if (params[0]["data"]) {
            //         return params[0]["name"] + "</br>" + params[0]["marker"] + params[0]["seriesName"] + ":  " + params[0]["data"] + '%' + "</br>" + params[1]["marker"] + params[1]["seriesName"] + ":  " + params[1]["data"] + '%'
            //     }
            // }
        },
        legend: {
            bottom: "bottom",
        },
        xAxis: {
            type: 'category',
            data: [
                '南宁市', '柳州市', '桂林市',
                '梧州市', '北海市', '防城港市',
                '钦州市', '贵港市', '玉林市',
                '百色市', '贺州市', '河池市',
                '来宾市', '崇左市'
            ],
            axisLine: {
                lineStyle: {
                    color: '#BCBCBC',
                    width: 1,//这里是为了突出显示加上的
                }
            },
            axisLabel: {
                interval: 0,
                rotate: 45,//倾斜度 -90 至 90 默认为0
                margin: 2,
                textStyle: {
                    fontWeight: "bolder",
                    color: "#BCBCBC",
                    fontSize: "70%",
                }
            },
        },
        grid: [
            {
                bottom: '25%',
                left: "18%",
                top: "18%",
            },
        ],
        yAxis: {
            type: 'value',
            axisLine: { show: false },
            axisTick: { show: false },
            axisLabel: {
                formatter: '{value} %',
                textStyle: {
                    fontWeight: "bolder",
                    color: "#BCBCBC",
                    fontSize: "70%",
                }
            }
        },
        series: [{
            name: '复工率',
            data: [33, 36, 42, 46, 55, 46, 47, 51, 62, 38, 49, 77, 91, 70],
            type: 'line',
            smooth: true,
            lineStyle: {
                color: "#00561F",
            },
            //设置点的样式
            itemStyle: {
                color: "#00561F",
            }
        },
        {
            name: '复产率',
            data: [26, 29, 36, 48, 54, 32, 36, 42, 46, 55, 46, 47, 67, 82],
            type: 'line',
            smooth: true,
            lineStyle: {
                color: "#1371FF",
            },
            //设置点的样式
            itemStyle: {
                color: "#1371FF",
            },
        },
        ],
    };






    var myChart2 = echarts.init(document.querySelector("div.bottom .bar1"));
    option2 = {
        backgroundColor: "white",
        tooltip: {
            trigger: 'axis',
            axisPointer: {            // 坐标轴指示器，坐标轴触发有效
                type: 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
            }
        },
        title: {
            left: 20,
            top: 20,
            //默认为10
            //2.主副标题之间的间距
            itemGap: 20,
            text: '统计企业数',
            textStyle: {
                //文字颜色
                color: '#333333',
                //字体风格,'normal','italic','oblique'
                fontStyle: 'normal',
                //字体粗细 'normal','bold','bolder','lighter',100 | 200 | 300 | 400...
                //fontWeight: 'bold',
                fontWeight: "350",
                //字体系列
                //字体大小
                fontSize: 15
            }
        },
        legend: {
            data: ['复工企业个数', '未复工企业个数'],
            bottom: "bottom",
        },
        grid: [
            {
                bottom: '15%',
                left: "18%",
                top: "12%"
            },
        ],
        xAxis: {
            type: 'value',
            splitLine: {
                show: false
            },
            axisLabel: {
                interval: 0,
                rotate: 50,//倾斜度 -90 至 90 默认为0
                margin: 2,
                textStyle: {

                    fontWeight: "bolder",
                    color: "#BCBCBC",
                    fontSize: "60%",
                }
            },
        },
        yAxis: {
            type: 'category',
            data: [
                '崇左市', '来宾市', '河池市',
                '贺州市', '百色市', '玉林市',
                '贵港市', '钦州市', '防城港市',
                '北海市', '梧州市', '桂林市',
                '柳州市', '南宁市'
            ],

            axisLine: { show: false },
            axisTick: { show: false },
            axisLabel: {
                interval: 0,
                rotate: 50,//倾斜度 -90 至 90 默认为0
                margin: 2,
                textStyle: {

                    fontWeight: "bolder",
                    color: "#BCBCBC",
                    fontSize: "60%",
                }
            },
        },
        series: [
            {
                name: '复工企业个数',
                type: 'bar',
                stack: '总量',
                label: {
                    show: false,
                    position: 'insideRight'
                },
                data: [
                    100, 120, 110, 130,
                    180, 200, 535, 608,
                    503, 1319, 1910, 2896,
                    1482, 3153
                ],
                itemStyle: {
                    normal: {
                        //设置柱形图的颜色
                        color: "#4A86CB"
                    }
                }
            },
            {
                name: '未复工企业个数',
                type: 'bar',
                stack: '总量',
                label: {
                    show: false,
                    position: 'insideRight',
                },
                data: [
                    130, 180, 200, 535,
                    608, 503, 510, 1153,
                    2196, 663, 47, 2503,
                    1070, 3002
                ],
                itemStyle: {
                    normal: {
                        //设置柱形图的颜色
                        color: "#E66926"
                    }
                }

            },
        ]
    };;

    //获取页面传递过来的参数
    company = decodeURI(location.search.split("=")[1])
    //console.log(company)

    let map = {
        "＃规模以上工业企业": "广西规模以上工业企业复工情况表",
        "规模以上服务业企业": "广西规模以上服务业企业复工情况表",
        "限额以上商贸服务业企业": "广西限额以上商贸服务业企业复工情况表",
        "农业龙头企业": "广西农业龙头企业复工情况表",
        "交通运输客货运企业": "广西交通运输客货运企业复工情况表",
        "房地产企业": "广西建筑业项目和房地产企业复工情况表",
        "外资企业": "广西外资企业和外贸企业复工情况表",
        "外贸企业": "广西外资企业和外贸企业复工情况表",
        "自治区层面统筹推进": "自治区层面统筹推进在建重大项目复工情况表",
        "建筑业施工项目": "广西建筑业项目和房地产企业复工情况表",
    }

    function formatData1(data) {

        let addr = [];
        let fugonglv = [];
        let fuchanlv = [];
        let fugong = [];
        let weifugong = [];


        data.forEach((item) => {
            addr.push(item["地区"]);
            fugonglv.push(item["复工率（%）"]);
            fugong.push(item["复工企业数（家）"]);
            fuchanlv.push(item["复产率（%）"]);
            weifugong.push(item["统计企业数（家）"] - item["复工企业数（家）"]);
        })

        return [addr, fugonglv, fuchanlv, fugong, weifugong].map((list) => list.reverse())
    }
    function formatData2(data, company) {
        //格式化外资外贸数据

        let addr = [];
        let fugonglv = [];
        let fuchanlv = [];
        let fugong = [];
        let weifugong = [];


        data.forEach((item) => {
            addr.push(item["地区"]);
            //console.log(item[company])
            fugonglv.push(item[company]["复工率（%）"]);
            fugong.push(item[company]["复工企业数（家）"]);
            fuchanlv.push(item[company]["复产率（%）"]);
            weifugong.push(item[company]["统计企业数（家）"] - item[company]["复工企业数（家）"]);
        })

        return [addr, fugonglv, fuchanlv, fugong, weifugong].map((list) => list.reverse())
    }
    function formatData3(data, company) {
        //格式化建筑行业和房地产行业
        let addr = [];
        let fugonglv = [];
        let fuchanlv = [];
        let fugong = [];
        let weifugong = [];

        if (company === "建筑业施工项目") {
            data.forEach((item) => {

                addr.push(item["地区"]);
                //console.log(item["建筑业项目"]["复工项目数（个）"])
                fugonglv.push(item["建筑业项目"]["复工率（%）"]);
                fugong.push(item["建筑业项目"]["复工项目数（个）"]);
                fuchanlv.push(item["建筑业项目"]["复产率（%）"]);
                weifugong.push(item["建筑业项目"]["施工项目数（个）"] - item["建筑业项目"]["复工项目数（个）"]);
            })
        } else {
            data.forEach((item) => {
                addr.push(item["地区"]);
                //console.log(item[company])
                fugonglv.push(item[company]["复工率（%）"]);
                fugong.push(item[company]["复工企业数（家）"]);
                fuchanlv.push(item[company]["复产率（%）"]);
                weifugong.push(item[company]["统计企业数（家）"] - item[company]["复工企业数（家）"]);
            })
        }


        return [addr, fugonglv, fuchanlv, fugong, weifugong].map((list) => list.reverse())
    }

    function formatData4(data) {
        let addr = [];
        let fugonglv = [];
        let fuchanlv = [];
        let fugong = [];
        let weifugong = [];


        data.forEach((item) => {
            addr.push(item["地区"]);
            //console.log(item[company])
            fugonglv.push(item["复工率（%）"]);
            fugong.push(item["复工项目数（个）"]);
            fuchanlv.push(item["复产率（%）"]);
            weifugong.push(item["重大项目数（个）"] - item["复工项目数（个）"]);
        })

        return [addr, fugonglv, fuchanlv, fugong, weifugong].map((list) => list.reverse())
    }
    function renderEchart(formatResult, company) {
        //折线图
        option1["series"][0]["data"] = formatResult[1] //复工率
        option1["title"]["text"] = company

        //复产率不存在
        if (formatResult[2].some((item) => item === undefined)) {
            option1["series"].pop();
        } else {
            option1["series"][1]["data"] = formatResult[2] //复工率存在
        }
        option1["xAxis"]["data"] = formatResult[0] //地区
        if (option1 && typeof option1 === "object") {
            myChart1.setOption(option1, true);
        }

        //柱状图
        option2["series"][0]["data"] = formatResult[3] //复工企业个数
        option2["series"][1]["data"] = formatResult[4] //未复工企业个数
        option2["yAxis"]["data"] = formatResult[0] //地区
        option2["title"]["text"] = company
        if (option2 && typeof option2 === "object") {
            myChart2.setOption(option2, true);
        }
    }
    $.getJSON(encodeURI("http://47.94.216.106/api/test?key=" + map[company])).done(
        function (result) {
            if (map[company] !== "广西建筑业项目和房地产企业复工情况表" &&
                map[company] !== "广西外资企业和外贸企业复工情况表"
                && map[company] !== "自治区层面统筹推进在建重大项目复工情况表"
            ) {
                if (result && result.data) {
                    console.log(result.data.data);
                    // console.log(formatData1(result.data.data))
                    formatResult = formatData1(result.data.data)
                    console.log(formatResult)

                    renderEchart(formatResult, company)

                }
            } else if (map[company] === "广西外资企业和外贸企业复工情况表") {
                if (result && result.data) {
                    console.log(result.data.data);
                    formatResult = formatData2(result.data.data, company)
                    console.log(formatResult)
                    renderEchart(formatResult, company)
                }
            } else if (map[company] === "广西建筑业项目和房地产企业复工情况表") {
                if (result && result.data) {
                    console.log(result.data.data);
                    formatResult = formatData3(result.data.data, company)
                    console.log(formatResult)
                    renderEchart(formatResult, company)
                }
            } else {
                if (result && result.data) {
                    console.log(result.data.data);
                    formatResult = formatData4(result.data.data)
                    console.log(formatResult)
                    renderEchart(formatResult, company)
                }
            }

        }
    )
    // option1["title"]["text"] = company
    // option2["title"]["text"] = company
    // myChart1.setOption(option1);
    //myChart2.setOption(option2)




</script>

</html>